// Add process polyfill for browser environment
if (typeof process === 'undefined') {
  window.process = {
    env: {}
  };
}

// Initialize Supabase client - using correct API key format
const SUPABASE_URL = 'https://artdirswzxxskcdvstse.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFydGRpcnN3enh4c2tjZHZzdHNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MDU5NDcsImV4cCI6MjA2NjQ4MTk0N30.YGOXgs0LtdCQYqpEWu0BECZFp9gRtk6nJPbOeDwN8kM';

let supabase = null;
let supabaseAvailable = false;
let selectedCategory = 'all';

// Initialize Supabase
try {
  if (typeof window.supabase !== 'undefined') {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    supabaseAvailable = true;
    console.log('Supabase client initialized');
  } else {
    console.log('Supabase library not available, using fallback data');
  }
} catch (error) {
  console.log('Failed to initialize Supabase, using fallback data:', error);
}

document.addEventListener('DOMContentLoaded', async () => {
  console.log('DOM loaded, initializing components...');

  const filterContainer = document.createElement('div');
  filterContainer.style.marginBottom = '16px';
  filterContainer.innerHTML = `
    <label style="color:#f1f1f1;margin-right:8px;">Filter by trend:</label>
    <select id="trendFilter" style="padding:6px 12px;border-radius:8px;background:#1a1a2e;color:#f1f1f1;border:1px solid #2e2e45;">
      <option value="all">All</option>
      <option value="aiTools">AI Tools</option>
      <option value="chatgpt">ChatGPT</option>
      <option value="ml">Machine Learning</option>
      <option value="blockchain">Blockchain</option>
      <option value="metaverse">Metaverse</option>
      <option value="nft">NFT</option>
      <option value="crypto">Crypto</option>
    </select>
  `;

  const chartSection = document.querySelector('.chart-section');
  if (chartSection) chartSection.insertBefore(filterContainer, chartSection.children[1]);

  document.getElementById('trendFilter').addEventListener('change', e => {
    selectedCategory = e.target.value;
    createNativeChart();
  });

  await createNativeChart();
  await createTrendTable();
});
